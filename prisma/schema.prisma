// Flux CRM - Team-based work management

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Team {
  id         String        @id @default(cuid())
  name       String
  createdAt  DateTime      @default(now())
  members    TeamMember[]
  channels   Channel[]
  tasks      Task[]
  invites    TeamInvite[]
}

model TeamMember {
  id       String   @id @default(cuid())
  email    String
  name     String?
  teamId   String
  team     Team     @relation(fields: [teamId], references: [id], onDelete: Cascade)
  joinedAt DateTime @default(now())
}

model TeamInvite {
  id        String   @id @default(cuid())
  teamId    String
  team      Team     @relation(fields: [teamId], references: [id], onDelete: Cascade)
  email     String
  token     String   @unique
  expiresAt DateTime
  createdAt DateTime @default(now())
}

model Channel {
  id        String           @id @default(cuid())
  name      String
  teamId    String
  team      Team             @relation(fields: [teamId], references: [id], onDelete: Cascade)
  createdAt DateTime         @default(now())
  messages  ChannelMessage[]
}

model ChannelMessage {
  id        String   @id @default(cuid())
  content   String
  author    String
  channelId String
  channel   Channel  @relation(fields: [channelId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
}

model Task {
  id           String          @id @default(cuid())
  title        String
  description  String?
  status       String          @default("TODO")
  priority     String          @default("MEDIUM")
  dueDate      DateTime?
  assignee     String?         // email of assignee
  teamId       String
  team         Team            @relation(fields: [teamId], references: [id], onDelete: Cascade)
  comments     TaskComment[]
  voiceNotes   VoiceNote[]
  attachments  TaskAttachment[]
  createdAt    DateTime        @default(now())
  updatedAt    DateTime        @updatedAt
}

model TaskAttachment {
  id       String   @id @default(cuid())
  url      String
  fileName String
  taskId   String
  task     Task     @relation(fields: [taskId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
}

model TaskComment {
  id        String   @id @default(cuid())
  content   String
  taskId    String
  task      Task     @relation(fields: [taskId], references: [id], onDelete: Cascade)
  author    String
  createdAt DateTime @default(now())
}

model VoiceNote {
  id       String   @id @default(cuid())
  url      String
  taskId   String
  task     Task     @relation(fields: [taskId], references: [id], onDelete: Cascade)
  duration Int      @default(0)
  createdAt DateTime @default(now())
}
